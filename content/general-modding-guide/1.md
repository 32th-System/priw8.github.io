[title=Evolution of ZUN's engine]
## Evolution of ZUN's engine, part 1
Since this focuses on ZUN's current engine, PC98 games are not included.

### The very, very beginning
The interesting thing about [game=6]EoSD[/game] is that, contrary to what some people seem to believe, ZUN did not program it himself. He actually got some help from PBG, and by "some" help I mean getting the entire ECL system which is kinda used to control everything that happens in the game. ECL originally appeared in the first Seihou game, source code of which is actually available [on github](https://github.com/pbghogehoge/ssg). Unsuprisingly, PBG appears in [game=6]EoSD[/game] credits under something like "program help". Anyway, here is a very basic [game=6]EoSD[/game] file format explanation:
- `.dat` - data archives (also invented by PBG afaik), contain all other files that the game uses. [game=6]EoSD[/game] is unique as it uses multiple .dat files to store different things, where later games just use one.
- `.ecl` - Enemy Control Language™ scripts, used to spawn enemies, define what they do, and obviously control the danmaku they shoot.
- `.anm` - animation files, contain scripts that control various ways how sprites are animated.
- `.std` - stage background files, contain both definitions of how the objects are arranged in 3D space and how the camera moves.
- `.end` - contain ending scripts, which contain text that's displayed and some other things.
- `.pos` - define music loop points.
- `msgx.dat` - while they use the .dat extension, they are a completely separate filetype. These files contain dialogue scripts which control the text during dialogues, face expressions used and some other things.
- `ver102.dat` - a text file with .dat extension.

It's also notable how many images are handled - there are separate images that define alpha (transparency). For example, file `etama3.png` does not have any transparency - instead, `etama3_a.png` defines which parts of the main image should be transparent. You can see these images below:  
[img=content/general-modding-guide/files/etama3.png]
[img=content/general-modding-guide/files/etama3_a.png]

### Perfect Cherry Blossom
[game=7]PCB[/game] changed quite a few things from EoSD. First of all, now there are only 2 `.dat` files - one for the music, and one for... everything else. Though, they are actually 2 completely different file formats, and `thbgm.dat` is actually quite silly. It's literally just a bunch of `.wav` files with their headers removed smashed into 1 large file. You can actually just import this big chunk of data into audacity to listen to it (select signed 16-bit PCM). As for file formats:  
- `th07.dat` - an archive format similar to the one used by [game=6]EoSD[/game].
- `.ecl` - once again, Enemy Control Language™ scripts, but enhanced with some fresh new features.
- `.anm` - now, they also contain (uncompressed) images themselves apart from animation scripts. Though, some images are still stored outside of ANMs in `.jpg` format.
- `.std` - stage backgrounds, same functionality as in [game=6]EoSD[/game].
- `.end` - same as previously.
- `thbgm.fmt` - replacement of `.pos` files. Most notably, defines where given songs start in the `thbgm.dat` file and the loop points. Also contains some `.wav` headers.
- `msgx.dat` - once again, dialogue scripts.
- `.sht` - ~~shit~~ shottype files. They do not actually have any scripts, which makes them quite limited in terms of what you can create. There are 2 `.sht`s per shottype, one for the focused shot and one for unfocused.
- `.ver` - a text format that contains some data about game versions. Seems to include the executable size and some other number that I don't know the meaning of (likely some hash). I'm not sure if the game actually uses it for anything.

Here is what the `th07_0100b.ver` file looks like, in case you're curious:  
[code]0009_ 566784 993132091  
0009a 596992 489076697  
0010_ 596992 3478009099  
0011_ 596992 3545283257  
0100_ 607744 2762572763  
0100a 626688 873307505  
0100b 650752 2932163676  [/code]  
(yes, the size of the 1.00b executable is exactly 650752 bytes)

### Imperishable Night
While [game=8]IN[/game] didn't change as much compared to [game=7]PCB[/game] as [game=7]PCB[/game] did compared to [game=6]EoSD[/game]. Actually, it barely changed anything as far as file formats are concerned. Of course, ECL was updated with new features and functions, probably same for ANM etc, but generally everything still has the same purpose. Shottypes now get one .sht per character, so teams use 2 and solo shots use 1. There's even still the weird `.ver` file.  
  
\.\.\.not much to be said, really. An interesting thing is this image that can be found in [game=8]IN[/game]'s files:  
[img=content/general-modding-guide/files/phantasm.jpg]  
Yes from [game=8]IN[/game]. ZUN never removed it.

### Phantasmagoria of Flower View
While one could probably assume that the file formats used by [game=9]PoFV[/game] would be different since, well, it's gameplay is quite different than all the other games. However, the file formats are actually really similar to the ones used in [game=8]IN[/game].
- `.msg` - ZUN just decided to make the `msgx.dat` files have a separate extension.
- `th09.mup` - \.\.\.I actually have no idea. Contains some strings that seems to have come from ZUN's computer, such as `C:\cygwin\home\zun\prog\th09\th09.dat`.
- `.sht` - one per character. Now, they also contain some spell name strings, like `死神「ヒガンルトゥール」` (16 slots for spell names in total, most are never used).
  
Other formats are mostly same as [game=8]IN[/game] (the `.ver` file is still present, if you're curious). Of course, ECL (and possibly ANM) was expanded with some new instructions, but the general format stayed the same.  
  
As much as I want to post something from game's files here as well, I don't find anything particularly interesting\.\.\.

### Shoot the bullet
Again, not much really changed in [game=95]StB[/game]. Some new instructions added for ECL and probably also ANM, bla bla bla. Though actually, there is one thing that I don't think anyone deciphered yet - the `player.sht` file. Despite the fact that it has a known file extension, the file format itself seems to be completely different. Maybe it will be reverse engineered in *3 days*™, who knows? And obviously there are no `.end` files because, uh, there are no endings. Though, `.msg` files still exist (in a completely different format, like `.sht`) - or well, actually just one, `mission.msg`. It's used to control the text displayed in textboxes in the mission select menu.
  
Random fact: did you know that the loading screen file in [game=95]StB[/game] is actually named `th08logo.jpg`, instead of `th95logo.jpg`?  
[img=content/general-modding-guide/files/th08logo.jpg]  
(In [game=9]PoFV[/game] it was called `th09logo.jpg`, as expected. This probably means that [game=95]StB[/game] was more based off [game=8]IN[/game].)

#### To be continued (on the next page)